LightboxOptions=Object.extend({fileLoadingImage:"/Content/SpletnaStran/Lightbox/loading.gif",fileBottomNavCloseImage:"/Content/SpletnaStran/Lightbox/closelabel.gif",overlayOpacity:.8,animate:!0,resizeSpeed:7,borderSize:10,labelImage:"Image",labelOf:"of"},window.LightboxOptions||{});var Lightbox=Class.create();Lightbox.prototype={imageArray:[],activeImage:void 0,initialize:function(){this.updateImageList(),this.keyboardAction=this.keyboardAction.bindAsEventListener(this),LightboxOptions.resizeSpeed>10&&(LightboxOptions.resizeSpeed=10),LightboxOptions.resizeSpeed<1&&(LightboxOptions.resizeSpeed=1),this.resizeDuration=LightboxOptions.animate?.15*(11-LightboxOptions.resizeSpeed):0,this.overlayDuration=LightboxOptions.animate?.2:0;var e=(LightboxOptions.animate?250:1)+"px",i=$$("body")[0];i.appendChild(Builder.node("div",{id:"overlay"})),i.appendChild(Builder.node("div",{id:"lightbox"},[Builder.node("div",{id:"outerImageContainer"},Builder.node("div",{id:"imageContainer"},[Builder.node("img",{id:"lightboxImage"}),Builder.node("div",{id:"hoverNav"},[Builder.node("a",{id:"prevLink",href:"#"}),Builder.node("a",{id:"nextLink",href:"#"})]),Builder.node("div",{id:"loading"},Builder.node("a",{id:"loadingLink",href:"#"},Builder.node("img",{src:LightboxOptions.fileLoadingImage})))])),Builder.node("div",{id:"imageDataContainer"},Builder.node("div",{id:"imageData"},[Builder.node("div",{id:"imageDetails"},[Builder.node("span",{id:"caption"}),Builder.node("span",{id:"numberDisplay"})]),Builder.node("div",{id:"bottomNav"},Builder.node("a",{id:"bottomNavClose",href:"#"},Builder.node("img",{src:LightboxOptions.fileBottomNavCloseImage})))]))])),$("overlay").hide().observe("click",function(){this.end()}.bind(this)),$("lightbox").hide().observe("click",function(e){"lightbox"==e.element().id&&this.end()}.bind(this)),$("outerImageContainer").setStyle({width:e,height:e}),$("prevLink").observe("click",function(e){e.stop(),this.changeImage(this.activeImage-1)}.bindAsEventListener(this)),$("nextLink").observe("click",function(e){e.stop(),this.changeImage(this.activeImage+1)}.bindAsEventListener(this)),$("loadingLink").observe("click",function(e){e.stop(),this.end()}.bind(this)),$("bottomNavClose").observe("click",function(e){e.stop(),this.end()}.bind(this));var t=this;(function(){var e="overlay lightbox outerImageContainer imageContainer lightboxImage hoverNav prevLink nextLink loading loadingLink imageDataContainer imageData imageDetails caption numberDisplay bottomNav bottomNavClose";$w(e).each(function(e){t[e]=$(e)})}).defer()},updateImageList:function(){this.updateImageList=Prototype.emptyFunction,document.observe("click",function(e){var i=e.findElement("a[rel^=lightbox]")||e.findElement("area[rel^=lightbox]");i&&(e.stop(),this.start(i))}.bind(this))},start:function(e){$$("select","object","embed").each(function(e){e.style.visibility="hidden"});var i=this.getPageSize();$("overlay").setStyle({width:i[0]+"px",height:i[1]+"px"}),new Effect.Appear(this.overlay,{duration:this.overlayDuration,from:0,to:LightboxOptions.overlayOpacity}),this.imageArray=[];var t=0;if("lightbox"==e.getAttribute("rel"))this.imageArray.push([e.href,e.title]);else for(this.imageArray=$$(e.tagName+'[href][rel="'+e.rel+'"]').collect(function(e){return[e.href,e.title]}).uniq();this.imageArray[t][0]!=e.href;)t++;var n=document.viewport.getScrollOffsets(),a=n[1]+document.viewport.getHeight()/10,o=n[0];this.lightbox.setStyle({top:a+"px",left:o+"px"}).show(),this.changeImage(t)},changeImage:function(e){this.activeImage=e,LightboxOptions.animate&&this.loading.show(),this.lightboxImage.hide(),this.hoverNav.hide(),this.prevLink.hide(),this.nextLink.hide(),this.imageDataContainer.setStyle({opacity:1e-4}),this.numberDisplay.hide();var i=new Image;i.onload=function(){this.lightboxImage.src=this.imageArray[this.activeImage][0],i.width>800&&(i.height=i.height/i.width*800,i.width=800),this.lightboxImage.width=i.width,this.lightboxImage.height=i.height,this.resizeImageContainer(i.width,i.height)}.bind(this),i.src=this.imageArray[this.activeImage][0]},resizeImageContainer:function(e,i){var t=this.outerImageContainer.getWidth(),n=this.outerImageContainer.getHeight(),a=e+2*LightboxOptions.borderSize,o=i+2*LightboxOptions.borderSize,h=a/t*100,s=o/n*100,r=t-a,d=n-o;0!=d&&new Effect.Scale(this.outerImageContainer,s,{scaleX:!1,duration:this.resizeDuration,queue:"front"}),0!=r&&new Effect.Scale(this.outerImageContainer,h,{scaleY:!1,duration:this.resizeDuration,delay:this.resizeDuration});var g=0;0==d&&0==r&&(g=100,Prototype.Browser.IE&&(g=250)),function(){this.prevLink.setStyle({height:i+"px"}),this.nextLink.setStyle({height:i+"px"}),this.imageDataContainer.setStyle({width:a+"px"}),this.showImage()}.bind(this).delay(g/1e3)},showImage:function(){this.loading.hide(),new Effect.Appear(this.lightboxImage,{duration:this.resizeDuration,queue:"end",afterFinish:function(){this.updateDetails()}.bind(this)}),this.preloadNeighborImages()},updateDetails:function(){this.caption.update(this.imageArray[this.activeImage][1]).show(),this.imageArray.length>1&&this.numberDisplay.update(LightboxOptions.labelImage+" "+(this.activeImage+1)+" "+LightboxOptions.labelOf+"  "+this.imageArray.length).show(),new Effect.Parallel([new Effect.SlideDown(this.imageDataContainer,{sync:!0,duration:this.resizeDuration,from:0,to:1}),new Effect.Appear(this.imageDataContainer,{sync:!0,duration:this.resizeDuration})],{duration:this.resizeDuration,afterFinish:function(){var e=this.getPageSize();this.overlay.setStyle({width:e[0]+"px",height:e[1]+"px"}),this.updateNav()}.bind(this)})},updateNav:function(){this.hoverNav.show(),this.activeImage>0&&this.prevLink.show(),this.activeImage<this.imageArray.length-1&&this.nextLink.show(),this.enableKeyboardNav()},enableKeyboardNav:function(){document.observe("keydown",this.keyboardAction)},disableKeyboardNav:function(){document.stopObserving("keydown",this.keyboardAction)},keyboardAction:function(e){var i,t=e.keyCode;i=e.DOM_VK_ESCAPE?e.DOM_VK_ESCAPE:27;var n=String.fromCharCode(t).toLowerCase();n.match(/x|o|c/)||t==i?this.end():"p"==n||37==t?0!=this.activeImage&&(this.disableKeyboardNav(),this.changeImage(this.activeImage-1)):("n"==n||39==t)&&this.activeImage!=this.imageArray.length-1&&(this.disableKeyboardNav(),this.changeImage(this.activeImage+1))},preloadNeighborImages:function(){var e,i;this.imageArray.length>this.activeImage+1&&(e=new Image,e.src=this.imageArray[this.activeImage+1][0]),this.activeImage>0&&(i=new Image,i.src=this.imageArray[this.activeImage-1][0])},end:function(){this.disableKeyboardNav(),this.lightbox.hide(),new Effect.Fade(this.overlay,{duration:this.overlayDuration}),$$("select","object","embed").each(function(e){e.style.visibility="visible"})},getPageSize:function(){var e,i;window.innerHeight&&window.scrollMaxY?(e=window.innerWidth+window.scrollMaxX,i=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,i=document.body.scrollHeight):(e=document.body.offsetWidth,i=document.body.offsetHeight);var t,n;return self.innerHeight?(t=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,n=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(t=document.documentElement.clientWidth,n=document.documentElement.clientHeight):document.body&&(t=document.body.clientWidth,n=document.body.clientHeight),pageHeight=n>i?n:i,pageWidth=t>e?e:t,[pageWidth,pageHeight]}},document.observe("dom:loaded",function(){new Lightbox});